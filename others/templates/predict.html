<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Heart Attack Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; box-sizing: border-box; }
    button { background: crimson; color: white; border: none; cursor: pointer; }
    .status { margin-top: 20px; font-weight: bold; }
    .probabilities { margin-top: 10px; }

    
    /* for panel */

    /* Menu icon styling */
    #menuIcon {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 30px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
        z-index: 1000;
        transition: transform 0.5s ease;
    }

    /* Lines of the menu icon */
    .line {
        width: 100%;
        height: 3px;
        background-color: black;
        margin: 3px 0;
        transition: all 0.3s;
    }

    /* Transform lines into X when panel opens */
    #menuIcon.open .line:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }

    #menuIcon.open .line:nth-child(2) {
        opacity: 0;
    }

    #menuIcon.open .line:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Side panel styling */
    #sidePanel {
        width: 0;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
        background-color: #f0f0f0;
        color: #333;
        overflow-x: hidden;
        transition: width 0.5s ease;
        padding: 0;
        z-index: 999;
    }

    /* Welcome text */
    #sidePanel p {
        display: none;
        padding: 20px;
        font-size: 1.2em;
        font-weight: bold;
        color: #555;
    }

    /* Expanded panel styles */
    #sidePanel.expanded {
        width: 250px;
    }

    #sidePanel.expanded p,
    #sidePanel.expanded .category {
        display: block;
    }

    /* Category and button styling */
    .category {
        padding: 20px;
        font-family: Arial, sans-serif;
    }

    .category h3 {
        margin-bottom: 10px;
        font-size: 1.1em;
        color: #555;
    }

    /* Links inside the panel */
    .buttons a {
        display: block;  /* Ensure the links stack vertically */
        text-decoration: none;
        color: #FFFFFF;
        margin-bottom: 15px;  /* Space between each link */
        font-size: 1em;
        transition: color 0.3s;
    }

    .buttons a:hover {
        color: #0056b3;
    }

    /* Remove any button-like appearance */
    .buttons button {
        background: none;
        border: none;
        font-size: inherit;
        color: inherit;
        text-align: left;
        padding: 0;
        cursor: pointer;
    }

    .buttons {
        display: flex;
        flex-direction: column;  /* Stack items vertically */
        gap: 10px;  /* Adds space between the buttons */
        width: 100%;  /* Makes sure the buttons take up the full width */
        max-width: 100%;
    }
    
    .buttons a {
        display: block;  /* Ensure the links take up full width */
        text-align: center;
        background-color: #000000;
        color: white;
        padding: 10px;
        text-decoration: none;
        border-radius: 4px;
        margin: 5px 0;  /* Adds margin between the buttons */
    }
    
    .buttons a:hover {
        background-color: #FFFFFF;
    }

    /* Home button icon styling */
    .home-icon {
        display: block;
        margin: 10px auto;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #ff8c00, #ff0080, #8000ff); /* Updated to vibrant gradient */
        border-radius: 50%;
        position: relative;
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-position 1s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background-size: 300%;
        cursor: pointer;
    }
    
   
    /* SVG Icon Embedded */
    .home-icon::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 24px;
        height: 24px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24"><path d="M12 3l9 9h-3v9h-12v-9h-3l9-9z"/></svg>');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        transform: translate(-50%, -50%);
    }
    
    /* Tooltip Styling */
    .home-icon[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: #fff;
        padding: 6px 10px;
        border-radius: 4px;
        white-space: nowrap;
        font-size: 12px;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
    }
    
    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }
    
    /* Hover state with moving gradient */
    .home-icon:hover {
        transform: scale(1.2);
        background-position: 100% 0; /* Moves the gradient */
        animation: pulse 1.5s infinite alternate;
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2), 0 0 15px rgba(76, 175, 80, 0.6);
    }
    
    /* Pulse animation */
    @keyframes pulse {
        from {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 0 5px rgba(255, 165, 0, 0.4);
        }
        to {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2), 0 0 15px rgba(255, 165, 0, 0.8);
        }
    }

    /* Active state */
    .home-icon.active {
        background: linear-gradient(135deg, #ff0080, #8000ff, #00ffbf); /* Brightened active state */
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2), 0 0 15px rgba(255, 165, 0, 0.8);
    }
  </style>
</head>
<body>
  <h2>Heart Attack Predictor</h2>

  
  <div id="menuIcon">
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
</div>

<div id="sidePanel">
    <br>
    <p>WELCOME!!</p>
    <a href="/" class="home-icon"></a> <!-- Home button icon with animation -->
    <div class="category">
        <h3>Features</h3>
        <div class="buttons">
          
        </div>
    </div>
</div>
  
  <input type="number" id="age" placeholder="Enter Age" />
  <input type="number" id="bp" placeholder="Enter Blood Pressure" />
  <input type="number" id="cholesterol" placeholder="Enter Cholesterol" />
  <input type="email" id="email" placeholder="Enter Email (optional)" />
  
  <button onclick="getPrediction()">Predict</button>
  
  <div class="status" id="status">Checking server...</div>
  <div id="prediction"></div>
  <div id="probabilities" class="probabilities"></div>

  <script>

    
        //panel area begins
        
        document.addEventListener('DOMContentLoaded', function () {
            populateOptions();
        });
  
        //for sidepanel
        const menuIcon = document.getElementById("menuIcon");
        const sidePanel = document.getElementById("sidePanel");
        
        // Open the panel on hover
        menuIcon.addEventListener("mouseenter", function() {
            sidePanel.classList.add("expanded");
            menuIcon.classList.add("open");  // Trigger the line transformation
        });
        
        // Close the panel when the mouse leaves the panel area
        sidePanel.addEventListener("mouseleave", function() {
            sidePanel.classList.remove("expanded");
            menuIcon.classList.remove("open");  // Reset the lines to their original state
        });
  
        //for home button
        // Add active class to Home button if on home page
        document.addEventListener('DOMContentLoaded', function () {
            const homeIcon = document.querySelector('.home-icon');
            if (window.location.pathname === '/') {
                homeIcon.classList.add('active');
            }
        });
        //panel area ends
  
    const hostedFlaskURL = "https://arogy.onrender.com/predict";
    const serverStatusURL = "https://arogy.onrender.com/";  // Flask server root

    const supabaseURL = "https://rsefkfixakbuqxqtsfww.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJzZWZrZml4YWtidXF4cXRzZnd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUyMjc0NDcsImV4cCI6MjA2MDgwMzQ0N30.y4RUJCw5xhpVBbRToZIZ-Jg7jJBlUKg_pMO41VP-1BU";

    window.onload = async () => {
      try {
        const res = await fetch(serverStatusURL);
        document.getElementById('status').textContent =
          res.ok ? "‚úÖ Server is ready!" : "‚ùå Server not available.";
      } catch (e) {
        document.getElementById('status').textContent = "‚ùå Failed to connect to server.";
      }
    };

    function getDerivedFeatures(age, bp, cholesterol) {
      const ageGroup = age < 40 ? "Young" : age <= 60 ? "Middle-aged" : "Senior";
      const bpLevel = bp < 80 ? "Low" : bp <= 120 ? "Normal" : "High";
      const cholesterolLevel = cholesterol < 150 ? "Low" : cholesterol <= 240 ? "Normal" : "High";
      const bpToAgeRatio = bp / age;
      const cholesterolToAgeRatio = cholesterol / age;
      const combinedRiskIndex = (bpToAgeRatio + cholesterolToAgeRatio) / 2;
      return { ageGroup, bpLevel, cholesterolLevel, bpToAgeRatio, cholesterolToAgeRatio, combinedRiskIndex };
    }

    async function getPrediction() {
      const age = parseInt(document.getElementById("age").value);
      const bp = parseInt(document.getElementById("bp").value);
      const cholesterol = parseInt(document.getElementById("cholesterol").value);
      const email = document.getElementById("email").value.trim();

      if (isNaN(age) || isNaN(bp) || isNaN(cholesterol)) {
        alert("Please fill in all required fields.");
        return;
      }

      const {
        ageGroup,
        bpLevel,
        cholesterolLevel,
        bpToAgeRatio,
        cholesterolToAgeRatio,
        combinedRiskIndex
      } = getDerivedFeatures(age, bp, cholesterol);

      const payload = {
        Age: age,
        BloodPressure: bp,
        Cholesterol: cholesterol,
        Age_Group: ageGroup,
        BP_Level: bpLevel,
        Cholesterol_Level: cholesterolLevel,
        BP_to_Age_Ratio: bpToAgeRatio,
        Cholesterol_to_Age_Ratio: cholesterolToAgeRatio,
        Combined_Risk_Index: combinedRiskIndex
      };

      document.getElementById('status').textContent = "‚è≥ Sending to server...";
      document.getElementById('prediction').textContent = '';
      document.getElementById('probabilities').textContent = '';

      try {
        const response = await fetch(hostedFlaskURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          const data = await response.json();
          const prediction = data.category;
          const probabilities = data.probabilities;

          document.getElementById("prediction").textContent = `üß† Prediction: ${prediction}`;
          document.getElementById("probabilities").innerHTML =
            Object.entries(probabilities).map(([k, v]) => `<div>${k}: ${(v * 100).toFixed(2)}%</div>`).join("");

          document.getElementById("status").textContent = "‚úÖ Prediction received!";

          if (email !== "") {
            await insertToSupabase({ age, bp, cholesterol, email, prediction });
          }
        } else {
          const error = await response.text();
          document.getElementById("status").textContent = `‚ùå Error: ${error}`;
        }
      } catch (err) {
        console.error(err);
        document.getElementById("status").textContent = "‚ùå Failed to connect to Flask server.";
      }
    }

    async function insertToSupabase({ age, bp, cholesterol, email, prediction }) {
      const tableName = "predictions";

      const record = {
        email,
        age,
        blood_pressure: bp,
        cholesterol,
        result: prediction,
        created_at: new Date().toISOString(),
      };

      try {
        const response = await fetch(`${supabaseURL}/rest/v1/${tableName}`, {
          method: "POST",
          headers: {
            "apikey": supabaseKey,
            "Authorization": `Bearer ${supabaseKey}`,
            "Content-Type": "application/json",
            "Prefer": "return=representation"
          },
          body: JSON.stringify(record)
        });

        if (response.status === 201) {
          console.log("‚úÖ Inserted into Supabase.");
        } else {
          console.warn("‚ùå Supabase insert failed:", await response.text());
        }
      } catch (e) {
        console.error("‚ùå Supabase error:", e);
      }
    }
  </script>
</body>
</html>
